<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
</head>
<body>
<h1 style="text-align: center;">The Spring Petclinic Application</h1>
<h3 style="text-align: center;">&nbsp;(rough draft : 15-JUL-2003)</h3>
<br>
<h2>Introduction</h2>
Spring is a collection of small, well-focused, loosely coupled Java
frameworks that can be used independently or collectively to build
industrial strength applications of many different types. It is
particularly useful for building enterprise applications. Enterprise
applications tend to have the following attributes:<br>
<ul>
  <li>Large amounts of Persistent data to access</li>
  <li>Large amounts of User Interface displays and data entry forms</li>
  <li>Complex Business logic</li>
  <li>Concurrent access by potentially many simultaneous users&nbsp;</li>
</ul>
The Petclinic sample application is designed to show how the Spring
application frameworks can be used to build simple, but powerful
database-oriented enterprise applications. It will demonstrate the use
of Spring's core functionality:<br>
<ul>
  <li>JavaBeans based application configuration</li>
  <li>Model-View-Controller web presentation layer</li>
  <li>Practical database access through JDBC</li>
  <li>Data Validation that is not dependent on the presentation  layer</li>
</ul>
In addition to showing developers how to get started with Spring, the
Petclinic sample will endeavor to demonstrate how Spring can used as an
effective tool for implementing applications that are concise, flexible,
testable, and maintainable. The Spring frameworks provide a great deal
of much needed infrastructure to simplify the tasks faced by application
developers. It provides infrastructure that helps developers to create
applications that are :<br>
<ul>
  <li><span style="font-weight: bold; text-decoration: underline;">concise</span>
by handling a lot of the complex control flow that is needed to use the
Java API's, such as JDBC, JNDI, JTA, RMI, and EJB.</li>
  <li><span style="font-weight: bold; text-decoration: underline;">flexible</span>
by simplifying the process of external application configuration through
the use of Reflection and JavaBeans. This allows the developer to
achieve a clean separation of configuration data from application code.
All application and web application objects, including validators,
workflow controllers, and views, should be JavaBeans that can be
configured externally. The validation and web application frameworks
provide good support for Internationalization.</li>
  <li><span style="font-weight: bold; text-decoration: underline;">testable</span>
by supplying an interface based design to maximize pluggability. This
facilitates the testing of Business Logic without requiring the presence
of application or live database servers.</li>
  <li><span style="font-weight: bold; text-decoration: underline;">maintainable</span>
by facilitating a clean separation of the application layers. It most
importantly helps maintain the independence of the Business Logic layer
from the Presentation layer through the use of  a Model-View-Controller
based web presentation framework that can work seamlessly with many
different types of view technologies. The web Spring web application
framework helps developers to implement their Presentation as a clean
and thin layer focused on its main missions of translating user actions
into application events and rendering model data.</li>
</ul>
It is assumed that users of this tutorial will have a basic knowledge
of object-oriented design, Java, Servlets, JSP, and relational
databases. It also assumes a basic knowledge of the use of a J2EE web
application container, Tomcat in particular.<br>
<br>
Since the purpose of the sample application is tutorial in nature, the
implementation presented here will of course provide only a small subset
of the functionality that would be needed by a real world version of the
Petclinic.<br>
<br>
<h2>Petclinic Sample Application Requirements</h2>
The application requirement is for an information system that is
accessible through a web browser. The users of the application are
employees of the clinic who in the course of their work need to view and
manage information regarding the veterinarians, the clients, and their
pets. The sample application supports the following:<br>
<br>
<span style="font-weight: bold;">Use Cases:</span><br>
<ul>
  <li>View a list of veterinarians and their specialties</li>
  <li>View information pertaining to a pet owner</li>
  <li>Update the information of a pet owner</li>
  <li>Add a new pet owner to the system</li>
  <li>View information pertaining to a pet</li>
  <li>Update the information of a pet</li>
  <li>Add a new pet to the system</li>
  <li>View information pertaining to a pet's visitation history</li>
  <li>Add information pertaining to a visit to the pet's visitation
history</li>
</ul>
<span style="font-weight: bold;">Business Rules:</span><br>
<ul>
  <li>An owner may not have multiple pets with the same name
(case-insensitive)<br>
  </li>
</ul>
<br>
<h2>Petclinic Sample Application Design &amp; Implementation</h2>
<span style="font-weight: bold; text-decoration: underline;">Server
Technology</span><br>
The sample application should be usable with any J2EE web application
container that is compatible with the Servet 2.3 and JSP 1.2
specifications. Some of the deployment files provided are designed
specifically for Apache Tomcat. These files specify container-supplied
connection pooled data sources. It is not necessary to use these files.
The application has been configured by default to use a data source
without connection pooling to simplify usage. Configuration details are
provided in the Developer Instructions section. The view technologies
that are to be used for rendering the application are Java Server Pages
(JSP) along with the Java Standard Tag Library (JSTL).<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">Database
Technology</span><br>
The sample application uses a relational database for data storage.
Support has been provided for a choice of 1 of 2 database selections,
Mysql or HypersonicSQL. HypersonicSQL version 1.7.1 is the default
choice and a copy is provided with the application.  It is possible to
easily configure the application to use either database. Configuration
details are provided in the Developer Instructions section.<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">Development
Environment</span><br>
A copy of the Spring runtime library jar file is provided with the
sample application along with some of the other required jar files. The
developer will need to obtain the following tools externally, all of
which are freely available:<br>
<ul>
  <li>Java SDK 1.4.1 * Ant 1.5.1</li>
  <li>Tomcat 4.1.18, or some other web application container</li>
  <li>JUnit 3.8.1 - needed to run the unit tests</li>
  <li>Mysql 3.23.53 with mysql-connector 2.0.14 (optional)</li>
</ul>
<span style="font-weight: bold;">NOTE:</span> The version numbers listed
were used in the development of the Petclinic application. Other
versions of the same tools may or may not work.<br>
<br>
Download links for the various tools needed are provided in the
Developer Instructions section.<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">Petclinic
Database</span><br>
The following is an overview of the database schema used in Petclinic.
Detailed field descriptions can be found in the "initDB.txt" SQL script
files in the database-specific "db" sub-directories. All "id" key fields
are of Java type int. For each table with a PRIMARY KEY there is a
corresponding sequencer table that is used to aid in the generation of
new primary keys. The name of the sequencer table is a conjunction of
the original table's name with "_seq".<br>
<br>
TABLE: <span style="font-weight: bold; font-style: italic;">owners</span><br>
&nbsp;&nbsp;&nbsp; PRIMARY KEY <span style="font-weight: bold;">id</span><br>
TABLE: <span style="font-weight: bold; font-style: italic;">owners_seq</span>
- sequencer for <span style="font-weight: bold; font-style: italic;">owners</span><br>
<br>
TABLE: <span style="font-weight: bold; font-style: italic;">types</span><br>
&nbsp;&nbsp;&nbsp; PRIMARY KEY <span style="font-weight: bold;">id</span><br>
TABLE: <span style="font-weight: bold; font-style: italic;">types_seq </span>-
sequencer for <span style="font-weight: bold; font-style: italic;">types</span><br>
<br>
TABLE: <span style="font-weight: bold; font-style: italic;">pets</span><br>
&nbsp;&nbsp;&nbsp; PRIMARY KEY <span style="font-weight: bold;">id</span><br>
&nbsp;&nbsp;&nbsp; FOREIGN KEY <span style="font-weight: bold;">type_id</span>
references the <span style="font-weight: bold; font-style: italic;">types</span>
table<span style="font-weight: bold;"> id </span>field<br>
&nbsp;&nbsp;&nbsp; FOREIGN KEY <span style="font-weight: bold;">owner_id</span>
references the <span style="font-weight: bold; font-style: italic;">owners</span>
table <span style="font-weight: bold;">id </span>field<br>
TABLE: <span style="font-weight: bold; font-style: italic;">pets_seq</span>
- sequencer for <span style="font-weight: bold; font-style: italic;">pets</span><br>
<br>
TABLE: <span style="font-weight: bold; font-style: italic;">vets</span><br>
&nbsp;&nbsp;&nbsp; PRIMARY KEY <span style="font-weight: bold;">id</span><br>
TABLE: <span style="font-weight: bold; font-style: italic;">vets_seq </span>-
sequencer for <span style="font-weight: bold; font-style: italic;">vets</span><br>
<br>
TABLE: <span style="font-weight: bold; font-style: italic;">specialties</span><br>
&nbsp;&nbsp;&nbsp; PRIMARY KEY <span style="font-weight: bold;">id</span><br
 style="font-weight: bold;">
TABLE: <span style="font-weight: bold; font-style: italic;">specialties_seq</span>-
sequencer for <span style="font-weight: bold; font-style: italic;">specialties</span><br>
<br>
TABLE: <span style="font-weight: bold; font-style: italic;">vet_specialties</span>-
a link table for <span style="font-weight: bold; font-style: italic;">vets</span>and
their <span style="font-weight: bold; font-style: italic;">specialties</span><br>
&nbsp;&nbsp;&nbsp; FOREIGN KEY <span style="font-weight: bold;">vet_id</span>
references the <span style="font-weight: bold; font-style: italic;">vets</span>table<span
 style="font-weight: bold;">id </span>field<br>
&nbsp;&nbsp;&nbsp; FOREIGN KEY <span style="font-weight: bold;">specialty_id</span>
references the <span style="font-weight: bold; font-style: italic;">specialties</span>table<span
 style="font-weight: bold;">id </span>field<br>
<br>
TABLE: <span style="font-weight: bold; font-style: italic;">visits</span><br>
&nbsp;&nbsp;&nbsp; PRIMARY KEY <span style="font-weight: bold;">id</span><br>
&nbsp;&nbsp;&nbsp; FOREIGN KEY <span style="font-weight: bold;">pet_id</span>
references the <span style="font-weight: bold; font-style: italic;">pets</span>table<span
 style="font-weight: bold;"> id </span>field<br>
TABLE: <span style="font-weight: bold; font-style: italic;">visits_seq </span>-
sequencer for <span style="font-weight: bold; font-style: italic;">visits</span><br>
<br>
<span style="font-weight: bold; text-decoration: underline;"></span><span
 style="font-weight: bold;"><br>
</span><span style="font-weight: bold;"></span><span
 style="font-weight: bold; text-decoration: underline;">Business Layer
classes</span><br>
<ul>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.Clinic</span>(interface)
- The high-level business API</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.Entity</span>-
simple JavaBean superclass of all database related JavaBeans</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.NamedEntity</span>-
adds name property to Entity, used directly to implement specialties
and pet types</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.Person</span>-
superclass of Vet and Owner</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.Vet</span>-
holds List of specialties</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.Owner</span>-
holds List of pets</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.Pet</span>-
holds List of visits</li>
  <li style="font-weight: bold; font-style: italic;">petclinic.Visit</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.NoSuchEntityException</span>(unchecked)</li>
  <li style="font-weight: bold; font-style: italic;">petclinic.validation.FindOwnerValidator</li>
  <li style="font-weight: bold; font-style: italic;">petclinic.validation.OwnerValidator</li>
  <li style="font-weight: bold; font-style: italic;">petclinic.validation.PetValidator</li>
  <li style="font-weight: bold; font-style: italic;">petclinic.validation.VisitValidator</li>
</ul>
<span style="font-weight: bold; text-decoration: underline;">Business/Persistence
Layer classes</span>
<ul>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.jdbc.AbstractJdbcClinic</span>-
default JDBC implementation of Clinic. Provides caches of all
specialties, all vets, all pet types, as well as of owners and their
pets and visits that have been found. Also provides default inner class
implementations of the required RdbmsOperation objects and their
respective execution ("do") methods.</li>
  <ul>
    <li><span style="font-weight: bold; font-style: italic;">VetsQuery </span>-
Base class for all Vet Query Objects, provides an all vets query</li>
    <li><span style="font-weight: bold; font-style: italic;">SpecialtiesQuery</span>-
All Vets specialties Query Object</li>
    <li><span style="font-weight: bold; font-style: italic;">VetSpecialtiesQuery</span>-
A particular Vet's specialties Query Object</li>
    <li><span style="font-weight: bold; font-style: italic;">OwnersQuery</span>-
Abstract base class for all Owner Query Objects</li>
    <li><span style="font-weight: bold; font-style: italic;">OwnerQuery </span>-
Owner by id Query Object</li>
    <li><span style="font-weight: bold; font-style: italic;">OwnersByNameQuery</span>-
Owners by last name Query Object</li>
    <li><span style="font-weight: bold; font-style: italic;">OwnerUpdate</span>-
Owner Update Object</li>
    <li><span style="font-weight: bold; font-style: italic;">OwnerInsert</span>-
Owner Insert Object</li>
    <li><span style="font-weight: bold; font-style: italic;">TypesQuery </span>-
All Pet types Query Object</li>
    <li><span style="font-weight: bold; font-style: italic;">Pets</span><span
 style="font-weight: bold; font-style: italic;">Query</span><span
 style="font-weight: bold; font-style: italic;"> </span>- Abstract base
class for all Pet Query Objects</li>
    <li><span style="font-weight: bold; font-style: italic;">Pet</span><span
 style="font-weight: bold; font-style: italic;">Query</span><span
 style="font-weight: bold; font-style: italic;"> </span>- Pet by id
Query Object</li>
    <li><span style="font-weight: bold; font-style: italic;">PetsByOwnerQuery</span>-
Pets by Owner Query Object</li>
    <li><span style="font-weight: bold; font-style: italic;">PetUpdate </span>-
Pet Update Object</li>
    <li><span style="font-weight: bold; font-style: italic;">PetInsert </span>-
Pet Insert Object</li>
    <li><span style="font-weight: bold; font-style: italic;">VisitsQuery</span>-
Visits by Pet Query Object</li>
    <li><span style="font-weight: bold; font-style: italic;">VisitInsert</span>-
Visit Insert Object<br>
    </li>
  </ul>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.</span><span
 style="font-weight: bold; font-style: italic;">jdbc</span><span
 style="font-weight: bold; font-style: italic;">.HsqlClinic </span>-
Hsql implementation of Clinic. Provides Hsql implementations of the
required RdbmsOperation Insertion objects. This class can be subclassed
to substitute customized implementations of the RdbmsOperation objects
and their respective execution ("do") methods for thee default versions.</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.</span><span
 style="font-weight: bold; font-style: italic;">jdbc</span><span
 style="font-weight: bold; font-style: italic;">.MyqlClinic </span>-
Mysql implementation of Clinic. Provides Mysql implementations of the
required RdbmsOperation Insertion objects. This class can be subclassed
to substitute customized implementations of the RdbmsOperation objects
and their respective execution ("do") methods for thee default versions.</li>
  <ul>
  </ul>
</ul>
<span style="font-weight: bold;">NOTE:</span> The business and
persistence layers are <span style="font-weight: bold;">COMPLETELY </span>independent
of the Presentation layer.<br>
<span style="font-weight: bold; text-decoration: underline;"></span><br>
<span style="font-weight: bold; text-decoration: underline;">Presentation
Layer (web application) classes</span><br>
<ul>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.web.ClinicController</span>-
subclass of MultiactionController to handle simple display oriented
URL's</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.web.AbstractClinicForm</span>-
subclass of SimpleFormController that is the superclass of the Add and
Edit forms</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.web.FindOwnerForm</span>-used
to find owners by last name</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.web.AddOwnerForm</span>-
used to add a new Owner</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.web.EditOwnerForm</span>-
used to edit an existing Owner</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.web.AddPetForm</span>-
used to add a new Pet</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.web.EditPetForm</span>-
used to edit an existing Pet</li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.web.AddVisitForm</span>-
adds a new Visit</li>
</ul>
<span style="font-weight: bold; text-decoration: underline;">Test
Classes</span>
<ul>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.</span><span
 style="font-weight: bold; font-style: italic;">Owner</span><span
 style="font-weight: bold; font-style: italic;">Test</span>- a simple
JUnit test class<span style="font-weight: bold; font-style: italic;"></span></li>
  <li><span style="font-weight: bold; font-style: italic;">petclinic.</span><span
 style="font-weight: bold; font-style: italic;">jdbc</span><span
 style="font-weight: bold; font-style: italic;">.JdbcClinicTest</span>-
a simple JUnit live test class</li>
</ul>
<span style="font-weight: bold; text-decoration: underline;">Views
&amp; Implemented Use Cases</span><br>
<ul>
  <li><span style="font-weight: bold; font-style: italic;">welcomeView </span>-
home screen provides links to display vets list, find an owner, or view
documentation</li>
  <li><span style="font-weight: bold; font-style: italic;">vetsView </span>-
displays all vets and their specialties * findOwnersForm - allows user
to search for owners by last name</li>
  <li><span style="font-weight: bold; font-style: italic;">findOwnersRedirectView</span>-
redirects to findOwnerForm * selectOwnerView - allows user to select
from multiple owners with the same last name</li>
  <li><span style="font-weight: bold; font-style: italic;">ownerView </span>-
displays a user's data and a list of the owner's pets and their data</li>
  <li><span style="font-weight: bold; font-style: italic;">ownerRedirect</span>-
redirects to ownerView * ownerForm - allows adding/editing an owner</li>
  <li><span style="font-weight: bold; font-style: italic;">petForm </span>-
allows adding/editing a pet * visitForm - allows adding a visit JSP
Pages</li>
  <li><span style="font-weight: bold; font-style: italic;">index.jsp </span>-
redirects to the welcome page</li>
  <li><span style="font-weight: bold; font-style: italic;">includes.jsp </span>-
statically included in all JSP's, sets session="false" and specifies
the taglibs in use</li>
  <li><span style="font-weight: bold; font-style: italic;">uncaughtException.jsp</span>-
the configured "error-page" displays a stack trace</li>
  <li><span style="font-weight: bold; font-style: italic;">welcome.jsp </span>-
displays links to search for an owner or display the vets page</li>
  <li><span style="font-weight: bold; font-style: italic;">vets.jsp </span>-
displays a list of vets and their specialties * findOwners.jsp -
displays a form allowing the user to search for an owner by last name</li>
  <li><span style="font-weight: bold; font-style: italic;">owners.jsp </span>-
displays a list of owners meeting the search criteria with a selection
button for each owner</li>
  <li><span style="font-weight: bold; font-style: italic;">owner.jsp </span>-
displays an owner and the pets owned along with the visit history</li>
  <li><span style="font-weight: bold; font-style: italic;">ownerForm.jsp</span>-
displays a form that allows adding or editing an owner</li>
  <li><span style="font-weight: bold; font-style: italic;">petForm.jsp </span>-
displays a form that allows adding or editing a pet</li>
  <li><span style="font-weight: bold; font-style: italic;">visitForm.jsp</span>-
displays a form that allows adding a visit</li>
</ul>
The following JSP's each display a form field and the bound error data
for that field:<br>
<ul>
  <li style="font-weight: bold; font-style: italic;">address.jsp</li>
  <li style="font-weight: bold; font-style: italic;">city.jsp</li>
  <li style="font-weight: bold; font-style: italic;">telephone.jsp</li>
  <li style="font-weight: bold; font-style: italic;">lastName.jsp</li>
  <li style="font-weight: bold; font-style: italic;">firstName.jsp</li>
</ul>
The following JSTL tags are used:<br>
<ul>
  <li style="font-weight: bold; font-style: italic;">c:out</li>
  <li style="font-weight: bold; font-style: italic;">c:redirect</li>
  <li style="font-weight: bold; font-style: italic;">c:url</li>
  <li style="font-weight: bold; font-style: italic;">c:forEach</li>
  <li style="font-weight: bold; font-style: italic;">c:if</li>
  <li style="font-weight: bold; font-style: italic;">fmt:message</li>
  <li style="font-weight: bold; font-style: italic;">fmt:formatDate</li>
</ul>
<span style="font-weight: bold; text-decoration: underline;">DESIGN
NOTES:</span><br>
<ol>
  <li>all JSP's are stored under /WEB-INF/jsp except for index.jsp
which is the configured "welcome-file"</li>
  <li>The use of JSP technology in the appplication is not exposed to
the user</li>
  <li>The end user never sees a URL ending in ".jsp".</li>
  <li>By convention, all URL's in the application ending in ".htm" are
handled by web application controllers. Static html pages ending in
".html", such as Javadocs, will be directly served to the end user.</li>
  <li>The results of all form entries are handled using browser round
trip redirection to minimize possible end user confusion.</li>
  <li>All pages are extremely simple implementations focusing only on
functionality</li>
</ol>
<span style="font-weight: bold; text-decoration: underline;">Directory
Structure</span><br>
f-- indicates a file<br>
d-- indicates a directory<br>
D-- indicates a directory that is created by the Ant build script<br>
<br>
d-- <span style="font-weight: bold; font-style: italic;">petclinic </span>:
the root directory of the project<br>
&nbsp;&nbsp;&nbsp; f-- <span
 style="font-weight: bold; font-style: italic;">build.xml </span>: the
Ant build script<br>
&nbsp;&nbsp;&nbsp; f-- <span
 style="font-weight: bold; font-style: italic;">build.properties </span>:
a properties file for the  Ant build script<br>
&nbsp;&nbsp;&nbsp; d-- <span
 style="font-weight: bold; font-style: italic;">src </span>: Java
source file directory tree<br>
&nbsp;&nbsp;&nbsp; d-- <span
 style="font-weight: bold; font-style: italic;">war </span>: the web
application source directory tree<br>
&nbsp;&nbsp;&nbsp; d-- <span
 style="font-weight: bold; font-style: italic;">test </span>: a
parallel testing directory tree<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; d-- <span
 style="font-weight: bold; font-style: italic;">src </span>: Java
testing source file directory tree<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; D-- <span
 style="font-weight: bold; font-style: italic;">.classes </span>:
compiled .class files<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; D-- <span
 style="font-weight: bold; font-style: italic;">reports/html </span>:
generated html-formatted test reports<br>
&nbsp;&nbsp;&nbsp; d-- <span
 style="font-weight: bold; font-style: italic;">db </span>: database
sql scripts and related files<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; d-- <span
 style="font-weight: bold; font-style: italic;">hsqldb </span>:
directory for files related to HSQL, contains scripts and a context
definition<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; d-- <span
 style="font-weight: bold; font-style: italic;">mysql </span>:
directory for files related to MYSQL, contains scripts and a context
definition<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; f-- <span
 style="font-weight: bold; font-style: italic;">petclinic_tomcat_all.xml</span>
: context definition for all db's<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; f-- <span
 style="font-weight: bold; font-style: italic;">build.xml</span> : Ant
script for populating/emptying the database<br>
&nbsp;&nbsp;&nbsp; D-- .<span
 style="font-weight: bold; font-style: italic;">classes </span>:
compiled .class files<br>
&nbsp;&nbsp;&nbsp; D-- <span
 style="font-weight: bold; font-style: italic;">dist </span>: Java
archive files<br>
&nbsp;&nbsp;&nbsp; D-- <span
 style="font-weight: bold; font-style: italic;">docs </span>: Javadoc
files<br>
<br>
<h2>Petclinic Application Configuration</h2>
The Petclinic web application is configured via the following files:<br>
<ul>
  <li><span style="font-weight: bold; font-style: italic;">war/WEB-INF/web.xml</span>-
the standard web application configuration file</li>
  <li><span style="font-weight: bold; font-style: italic;">war/WEB-INF/applicationContext.xml</span>-
configures application wide objects</li>
  <li><span style="font-weight: bold; font-style: italic;">war/WEB-INF/petclinic-servlet.xml</span>-
configures the petclinic dispatcher servlet and the other controllers
and forms that it uses</li>
  <li><span style="font-weight: bold; font-style: italic;">war/WEB-INF/classes/views*.properties</span>-
configures the definition of internationalizable Spring views</li>
  <li><span style="font-weight: bold; font-style: italic;">war/WEB-INF/classes/messages*.properties</span>-
configures the definition of internationalizable message resources</li>
  <li><span style="font-weight: bold; font-style: italic;">war/WEB-INF/classes/log4j.properties</span>-
configures the definition of log4j loggers</li>
</ul>
Examine the contents of each of these files for a more in-depth
understanding of the details of how the application is configured.<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">General</span><br>
<ul>
  <li>In <span style="font-weight: bold; font-style: italic;">web.xml</span>,
a context-param, "<span style="font-weight: bold;">webAppRootkey</span>",
provides the key for a system property that specifies the root
directory for the web application. This parameter,&nbsp; <span
 style="font-weight: bold;">"petclinic.root"</span>, can be used to aid
in configuring the application.</li>
  <li>In <span style="font-weight: bold; font-style: italic;">web.xml</span>,
a <span style="font-weight: bold;">ContextLoaderListener </span>is
defined that loads the root application context of this web app at
startup, by default from <span
 style="font-weight: bold; font-style: italic;">/WEB-INF/applicationContext.xml</span>.
The root context is the parent of all servlet-specific contexts. This
means that its beans are automatically available in these child
contexts, both for Spring getBean(name) calls and (external) bean
references. Spring ApplicationContext objects provide access to a map of
user-defined JavaBeans that specify singleton or prototype instances
that are used in any and all layers of the application.</li>
  <li>In <span style="font-weight: bold; font-style: italic;">web.xml</span>,
a <span style="font-weight: bold;">Servlet </span>named <span
 style="font-weight: bold;">"petclinic" </span>is specified to act as
a dispatcher for the entire application. This <span
 style="font-weight: bold;">Servlet </span>is used to handle all URL's
matching the pattern <span style="font-weight: bold;">"*.htm"</span>.
As with any <span style="font-weight: bold;">Servlet</span>, multiple
URL mappings may be defined. It is also possible to define multiple
instances of <span style="font-weight: bold;">DispatcherServlet</span>.
Each <span style="font-weight: bold;">DispatcherServlet </span>dispatches
requests to registered handlers (<span style="font-weight: bold;">Controller</span>
implementations). Each <span style="font-weight: bold;">DispatcherServlet</span>has
its own <span style="font-weight: bold;">ApplicationContext</span>, by
default defined in <span style="font-weight: bold;">"{servlet-name}-servlet.xml"</span>.
In this case, it is in <span style="font-weight: bold;">"petclinic-servlet.xml"</span>.
This <span style="font-weight: bold;">ApplicationContext </span>is
used to specify the various web application user interface beans and URL
mappings that are used by the <span style="font-weight: bold;">DispatcherServlet</span>.</li>
  <li>In <span style="font-weight: bold; font-style: italic;">web.xml</span>,
the Spring tag library uri and location are specified for use by the
JSP pages.</li>
</ul>
<span style="font-weight: bold; text-decoration: underline;">ApplicationContext</span><br>
3 globally accessible beans are defined in the Petclinic
applicationContext.xml file:<br>
<ol>
  <li><span style="font-weight: bold; font-style: italic;">messageSource</span>-
a singleton bean that defines a message source for this context, loaded
from localized <span style="font-weight: bold;">"messages_xx"</span>
files in the classpath, such as <span
 style="font-weight: bold; font-style: italic;">"/WEB-INF/classes/messages.properties"</span>
or <span style="font-weight: bold; font-style: italic;">"/WEB-INF/classes/messages_de.properties"</span>.<span
 style="font-weight: bold;">"getMessage" </span>calls to this context
will use this source. Child contexts can have their own message sources,
which will inherit all messages from this source and are able to define
new messages and override ones defined in this source.</li>
  <li><span style="font-weight: bold; font-style: italic;">dataSource </span>-
a singleton bean that defines the implementation of the source of
database connections used by the application.</li>
  <li><span style="font-weight: bold; font-style: italic;">clinic </span>-
- a singleton bean that defines the implementation of the <span
 style="font-weight: bold;">Clinic </span>interface that provides the
primary Business layer object of the application.</li>
</ol>
<span style="font-weight: bold; text-decoration: underline;">Logging</span><br>
Spring supports the use of the Apache Commons Logging API.This API
provides the ability to use Java 1.4 loggers, the simple Commons
loogers, and&nbsp;<span style="font-weight: bold;">Apache </span><span
 style="font-weight: bold;">Log4J</span>. Petclinic uses&nbsp;<span
 style="font-weight: bold;"></span><span style="font-weight: bold;">Log4J</span>to
provide sophisticated and configurable logging capabilities. The files <span
 style="font-weight: bold; font-style: italic;">web.xml </span>and <span
 style="font-weight: bold; font-style: italic;">log4j.properties </span>specify
the configuration of logging in the system:<br>
<ul>
  <li>In <span style="font-weight: bold; font-style: italic;">web.xml</span>,
a <span style="font-weight: bold;">"log4jConfigLocation" </span>context-param
is specified that sets the location of the <span
 style="font-weight: bold;">Log4j </span>configuration file. The
default location for this file is <span
 style="font-weight: bold; font-style: italic;">/WEB-INF/classes/log4j.properties</span>.
Specifying this parameter explicitly allows the location to be changed
from the default and it also is used to cause periodic <span
 style="font-weight: bold;">Log4j </span>configuration refresh checks.</li>
  <li>In <span style="font-weight: bold; font-style: italic;">web.xml</span>,
a <span style="font-weight: bold;">Log4jConfigListener </span>is
specified that will initialize <span style="font-weight: bold;">Log4j </span>using
the specified configuration file when the web app starts.</li>
  <li>In <span style="font-weight: bold; font-style: italic;">log4j.properties</span>,
the following loggers are specified:</li>
  <ul>
    <li><span style="font-weight: bold; font-style: italic;">"stdout" </span>provides
logging messages to the container's log file.</li>
    <li><span style="font-weight: bold; font-style: italic;">"logfile" </span>provides
logging messages to a rolling file that is specifed using the
previously defined "petclinic.root".<br>
    </li>
  </ul>
</ul>
<span style="font-weight: bold; text-decoration: underline;">DispatcherServlet</span><br>
The following beans that are accessible to the <span
 style="font-weight: bold;">"petclinic" </span><span
 style="font-weight: bold;">DispatcherServlet </span>are defined in
the Petclinic <span style="font-weight: bold; font-style: italic;">petclinic-servlet.xml</span>
file. This dispatcher uses these defintions to delegate actual display
and form processing tasks to implementations of the Spring interface
Controller.<br>
<ul>
  <li><span style="font-weight: bold; font-style: italic;">viewResolver </span>-
a singleton bean that defines the implementation of the source of view
mappings used by the dispatcher. This definition specifies explicit view
mappings in a resource bundle (properties file) instead of the default
InternalResourceViewResolver. It fetches the view mappings from
localized <span style="font-style: italic; font-weight: bold;">"views_xx</span><span
 style="font-style: italic; font-weight: bold;">.properties</span><span
 style="font-style: italic; font-weight: bold;">"</span><span
 style="font-weight: bold; font-style: italic;"> </span><span
 style="font-style: italic;"></span> files, i.e. <span
 style="font-weight: bold; font-style: italic;">"/WEB-INF/classes/views.properties"</span>
or <span style="font-weight: bold; font-style: italic;">"/WEB-INF/classes/views_de.properties"</span>.
Symbolic view names returned by controllers will be resolved in the
respective properties file, allowing for arbitrary mappings between
names and resources.</li>
  <li><span style="font-weight: bold; font-style: italic;">urlMapping </span>-
a singleton bean that defines the URL mapping handler that is to be
used by the dispatcher. The definition specifies the use of a <span
 style="font-weight: bold;">SimpleUrlHandlerMapping </span>instead of
the default <span style="font-weight: bold;">BeanNameUrlHandlerMapping.</span>Specific
URL's are mapped directly to <span style="font-weight: bold;">Controllers</span>.</li>
  <li><span style="font-weight: bold; font-style: italic;">clinicController</span>-
a singleton bean that defines the <span style="font-weight: bold;">Controller</span>used
by the dispatcher to handle non-form based display tasks. This bean is
a <span style="font-weight: bold;">MultiActionController </span>that
can handle multiple requests.</li>
  <li><span style="font-weight: bold; font-style: italic;">clinicControllerMethodnameResolver</span>-
a singleton bean that defines a mapping of URL's to method names for
the <span style="font-weight: bold; font-style: italic;">clinicController</span>bean.</li>
  <li>6&nbsp;singleton form beans are defined that are extensions of
the Petclinic class <span style="font-weight: bold;">AbstractClinicForm</span>which
is an extension of the Spring class <span style="font-weight: bold;">SimpleFormController</span>.
These beans are used to handle the various Search, Add and Edit form
processing tasks for the dispatcher.</li>
  <li>4  singleton beans are defined that are implementations of the <span
 style="font-weight: bold;">Validator </span>interface. These beans
are used by the form beans to validate their input parameters and to
bind localizable error messages for display should a processing error
occur on submission.</li>
</ul>
<span style="font-weight: bold; text-decoration: underline;">Views</span><br>
The <span style="font-weight: bold;">Controllers </span>used by the
dispatcher handle the control flow of the application. The actual
display tasks are delegated by the <span style="font-weight: bold;">Controllers</span>to
implementations of the Spring <span style="font-weight: bold;">View </span>interface.
These <span style="font-weight: bold;">View </span>objects are
themselves beans that can render a particular type of view. The handling <span
 style="font-weight: bold;">Controller </span>supplies the <span
 style="font-weight: bold;">View </span>with a data <span
 style="font-weight: bold;">Model </span>to render. <span
 style="font-weight: bold;">Views </span>are only responsible for
rendering a display of the data model and performing any display logic
that is particular to the type of <span style="font-weight: bold;">View</span>being
rendered. Spring provides support for rendering many different types of
views: JSP, XSLT, PDF, Velocity templates, Excel files, and others. By
using a <span style="font-weight: bold;">View </span>mapping strategy,
Spring supplies the developer with a great deal of flexibility in
supporting easily configurable view substitution. Petclinic defines 10
View beans in the file, <span
 style="font-weight: bold; font-style: italic;">views.properties</span>.
2 of these beans are instances of <span style="font-weight: bold;">RedirectView</span>which
simply redirects to another URL. The other 8 View beans are instances
of <span style="font-weight: bold;">JstlView </span>which provides
some handy support for supporting internationalization/localization in
JSP pages that use JSTL.<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">Messages</span><br>
The <span style="font-weight: bold; font-style: italic;">messages*.properties</span>
files provide localized messages for the supported languages. Petclinic
supplies only a single localized message, <span
 style="font-weight: bold;">"welcome"</span> in the default, English,
and German properties files respectively.<br>
<br>
<br>
<h2>Petclinic Application Internal Workings 	(not yet available)</h2>
<br>
<h2>Developer Instructions</h2>
<span style="font-weight: bold; text-decoration: underline;">Tools</span><br>
<ul>
  <li>Download and install the <a
 href="http://sourceforge.net/projects/springframework/">Spring
Framework</a> (examples, including Petclinic are provided)</li>
  <li>Download and install a <a href="http://java.sun.com/">Java</a>
Software Developer Kit, preferably version 1.4 or later</li>
  <li>Download and install <a href="http://ant.apache.org">Apache Ant</a>,
preferably version 1.5.1 or later</li>
  <li>Download and install <a href="http://www.junit.org/index.htm">JUnit</a>,
preferably version 3.8.1 or later</li>
  <li>Download and install <a
 href="http://jakarta.apache.org/tomcat/index.html">Apache Tomcat</a>,
preferably version 4.1.18 or later</li>
  <li>Download and install <a href="http://www.mysql.com/">Mysql</a>,
(optional)</li>
  <li><a href="http://hsqldb.sourceforge.net/">Hypersonic SQL</a>
version 1.7.1 is provided with the application.</li>
  <li>Petclinic and Spring use the <a href="http://www.apache.org/">Apache</a> <a
 href="http://jakarta.apache.org/commons/logging.html">Commons Logging</a>
and <a href="http://jakarta.apache.org/log4j/docs/index.html">Log4J</a>
packages</li>
</ul>
<span style="font-weight: bold; text-decoration: underline;">Ant Setup</span><br>
Make sure that the Ant executable is in your command shell path. Ant
will need to reference classes from JUnit and the database(s) of
interest. Place a copy of any needed jar files in Ant's <span
 style="font-weight: bold; font-style: italic;">/lib </span>directory,
i.e.:<br>
<ul>
  <li>JUnit - junit.jar</li>
  <li>HSQL - hsqldb.jar</li>
  <li>MYSQL - mysql-connector-java-2.0.14-bin.jar or other</li>
</ul>
<span style="font-weight: bold; text-decoration: underline;">HSQL Setup</span><br>
Create a new directory containing the a copy of the entire contents of
the directory <span style="font-weight: bold; font-style: italic;">petclinic/db/hsqldb</span>.
The file <span style="font-weight: bold; font-style: italic;">petclinic.script</span>
is the data file that will be used by the server. It has been
initialized with some sample data. Start a server on the standard port
9001 by executing <span style="font-weight: bold; font-style: italic;">server.sh</span>(Unix)
or <span style="font-weight: bold; font-style: italic;">server.bat </span>(Windows).
A useful database manager can be started by&nbsp; by executing <span
 style="font-weight: bold; font-style: italic;">manager.sh </span>(Unix)
or <span style="font-weight: bold; font-style: italic;">manager.bat </span>(Windows).
When the application opens, connect to the "HSQL Database Engine
Server" using the default parameters.  This tool can also be used to
manage other databases. To use a different port, it will be necessary to
change the Petclinic Database Setup. It may also be necessary to consult
the HSQL documentation for instructions on to change the port the
server uses.<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">MYSQL
Setup (optional)</span><br>
Add the database to a running server by running the SQL script <span
 style="font-weight: bold; font-style: italic;">db/mysql/initDB.txt</span>.
The Petclinic expects, by default to be able to access the server via
the standard port 3306.  To use a different port, it will be necessary
to change the Petclinic Database Setup.<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">Petclinic
Database Setup</span><br>
To use a connection pooled data source with Tomcat, it will be
necessary to use and possibly edit the appropriate context definition
file for the petclinic webapp. To use it, deploy a copy in Tomcat's
webapps directory and restart the server. Consult the Tomcat log files
if something goes wrong when starting either Tomcat or the Petclinic
application. The context files are named <span
 style="font-weight: bold; font-style: italic;">petclinic_tomcat_*.xml</span>,
where <span style="font-weight: bold; font-style: italic;">*</span> is
a codename for the database. There is a context file supplied for each
database in its respective directory. There is also a context file <span
 style="font-weight: bold; font-style: italic;">db/petclinic_tomcat_all.xml</span>that
will provide a JNDI datasource for all supported databases<span
 style="font-weight: bold; font-style: italic;"></span>. Should you use
this file, you must of course make sure that all the database servers
are running when you restart Tomcat.<br>
<br>
<span style="font-weight: bold;"><a name="dbNotes"></a>NOTES:</span> <br>
<ol>
  <li>Should you deploy one of the context files or define a context in
Tomcat's <span style="font-weight: bold; font-style: italic;">server.xml</span>,
Tomcat will not automatically deploy the webapp from the <span
 style="font-weight: bold; font-style: italic;">petclinic.war </span>file.
The webapp will then need to be manually extracted to the target
directory.</li>
  <li>The context files will also configure logging for the context to
supply a separate log file for the petclinic context. This will separate
the container logging for petclinic from that of the other webapps.
This should not be confused with the application log file provided
through <span style="font-weight: bold;">Log4j.</span></li>
  <li><span style="font-weight: bold;"></span>An Ant script (<span
 style="font-weight: bold; font-style: italic;">db/build.xml </span>)
has been provided that can be used to re-initialize either database. To
select or configure the data source used for the webapp and for testing,
you will need to edit the files:<br>
  </li>
</ol>
<ul style="margin-left: 40px;">
  <li style="font-weight: bold;"><span style="font-weight: normal;"><span
 style="font-weight: bold; font-style: italic;">war/WEB-INF/applicationContext.xml</span>
(for the webapp)</span> <span style="font-weight: normal;"></span></li>
  <li><span style="font-weight: bold; font-style: italic;">build.properties</span>
(for testing)</li>
  <li style="font-weight: bold;"><span style="font-style: italic;">test/src/testContext.xml</span>&nbsp;<span
 style="font-weight: normal;"> (for testing)</span></li>
</ul>
<span style="font-weight: bold; text-decoration: underline;">Building
the Petclinic Application</span><br>
Open a command line shell and navigate to the directory containing
Petclinic and execute "ant". This will display a list of the Ant targets
that are available. Make sure the database is running and execute "ant
all". This will run the Ant "all" target which will clean and compile
everything, produce Javadocs, and execute a live test using the
database. The other Ant targets provide subsets of this functionality.<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">Deploying
the Petclinic Application</span><br>
Deploy the web application to the server in the usual way (see <a
 href="#dbNotes">notes</a> regarding database setup). If you need
instructions for this, see the Tomcat documentation for details. The Web
ARchive file is <span style="font-weight: bold; font-style: italic;">petclinic.war</span>and
can be found in the <span
 style="font-weight: bold; font-style: italic;">dist </span>directory.<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">Using the
Petclinic Application</span><br>
Make sure the Petclinic web application is running and browse to <a
 href="http://localhost:8080/petclinic">http://localhost:8080/petclinic</a>
or <a href="http://www.springframework.org/webapps/petclinic">check it
out online</a>.<br>
<br>
<br>
</body>
</html>
